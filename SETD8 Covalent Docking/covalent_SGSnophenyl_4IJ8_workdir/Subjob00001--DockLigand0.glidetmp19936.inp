write file -
"Subjob00001--DockLigand0.out" -
      title -
"Subjob00001--DockLigand0" *

PUT 0 INTO 'buildcheck' 
PUT 1 INTO 'startlig' 
PUT 0 INTO 'endlig' 
PUT -1 INTO 'strucseq' 

SET FFIELD OPLS_2005

DOCK
  smooth anneal 2
  ligand multiple maxat 300 maxrot 50 -
   ligvdwscale factor 0.800000 ccut 0.150000
  receptor rdiel readzip -
"Subjob00001--CreateGrid-out" -
  constraints  loosedock 2 featurefile -
"Subjob00001--DockLigand0.feat" -
   consname -
"Subjob00001--CreateGrid-out.cons"
  screen  readscreen -
"Subjob00001--CreateGrid-out.save" -
   greedy readgreed -
"Subjob00001--CreateGrid-out_greedy.save" -
   maxkeep 5000 scorecut 100.000000
  parameter setup save   maxconf 1000
  final glidescore
  report setup nreport 0   -
   external file -
"Subjob00001--DockLigand0_raw.maegz" -
   norecep -
   maxperlig 10 rmspose 0.500000 delpose 1.300000 epik
  run
QUIT

PUT 'startlig' INTO 'strucseq'
CREATE
  build primary name lig type auto maxat 300 -
   read maestro file -
"Subjob00001--DockLigand0-in.maegz" -
   gotostruct 'startlig' skip_recep
IF 'buildcheck' LT 0 
QUIT
  IF 'buildcheck' EQ -1 
    ECHO "END OF LIGAND FILE: Subjob00001--DockLigand0-in.maegz"
  ENDIF
  IF 'buildcheck' EQ -2 
     ECHO "ERROR READING LIGAND FILE: Subjob00001--DockLigand0-in.maegz"
  ENDIF
    ECHO "No ligands read; aborting."
    GOTO ABORT
ELSE
  build types name lig
QUIT
ENDIF

PUT 'startlig' INTO 'i'
WHILE ('endlig' LT 1 OR 'i' LE 'endlig')

DOCK
  ligand name lig
  screen
  parameter save
  confgen  torsion amide penal name lig -
   ecut 12.000000
  run
QUIT

DOCK
  smooth anneal 2
  ligand keep
  screen noscore refine maxref 400
  parameter save
  minimize flex itmax 100 dielco 2.000000 -
   postdock 10 ligmin pmitmax 500
  scoring ecvdw 0.000000 hbfilt 0.000000 metalfilt 10.000000 gscorecut 100.000000 
  report collect -
   rmspose 0.500000 delpose 1.300000
  run
QUIT
IF ('i' EQ 'endlig')
  ECHO "FINISHED REQUESTED RANGE IN LIGAND FILE: Subjob00001--DockLigand0-in.maegz"
ECHO "Proceeding with final processing of ligands."
  GOTO BREAK
ENDIF

PUT 'i' + 1 INTO 'strucseq'
CREATE
  build primary check name lig type auto maxat 300 -
   read maestro file -
"Subjob00001--DockLigand0-in.maegz" -
   nextstruct

IF 'buildcheck' LT 0 
QUIT
  IF 'buildcheck' EQ -1 
    ECHO "END OF LIGAND FILE: Subjob00001--DockLigand0-in.maegz"
  ENDIF
  IF 'buildcheck' EQ -2 
     ECHO "ERROR READING LIGAND FILE: Subjob00001--DockLigand0-in.maegz"
  ENDIF
ECHO "Proceeding with final processing of ligands."
  GOTO BREAK
ELSE
  build types name lig
QUIT
ENDIF

PUT 'i' + 1 INTO 'i'
ENDWHILE
:BREAK

DOCK
  parameter clean final
  report -
   rmspose 0.500000 delpose 1.300000  write filename -
"Subjob00001--DockLigand0"
  run
QUIT
:ABORT

END
